<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Email | Luis Cacho</title>
    <link>/en/tags/email/</link>
      <atom:link href="/en/tags/email/index.xml" rel="self" type="application/rss+xml" />
    <description>Email</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><copyright>Â© 2019</copyright><lastBuildDate>Wed, 08 Apr 2015 00:39:38 -0600</lastBuildDate>
    <image>
      <url>/img/lc-profile.png</url>
      <title>Email</title>
      <link>/en/tags/email/</link>
    </image>
    
    <item>
      <title>Spamassassin Error: cannot create user preferences file //.spamassassin/user_prefs: Permission denied on VestaCP - CentOS</title>
      <link>/spamassassin-error-on-vestacp-centos/</link>
      <pubDate>Wed, 08 Apr 2015 00:39:38 -0600</pubDate>
      <guid>/spamassassin-error-on-vestacp-centos/</guid>
      <description>&lt;p&gt;When you configure spamassassin on VestaCP (CentOS) sometimes you might have some problems with the autolearn feature and also with the bayes plugin of spamassassin.&lt;/p&gt;

&lt;p&gt;The error looks like:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;more /var/log/maillog

Apr  5 00:31:00 vestaserver01 spamd[1353]: spamd: connection from localhost [127.0.0.1] at port 37022
Apr  5 00:31:00 vestaserver01 spamd[1353]: spamd: setuid to nobody succeeded
Apr  5 00:31:00 vestaserver01 spamd[1353]: spamd: creating default_prefs: //.spamassassin/user_prefs
Apr  5 00:31:00 vestaserver01 spamd[1353]: config: cannot create user preferences file //.spamassassin/user_prefs: No such file or directory
Apr  5 00:31:00 vestaserver01 spamd[1353]: spamd: failed to create readable default_prefs: //.spamassassin/user_prefs
Apr  5 00:31:00 vestaserver01 spamd[1353]: spamd: checking message &amp;amp;lt;5520C87B.8020009@example.com&amp;amp;gt; for nobody:99
Apr  5 00:31:00 vestaserver01 spamd[1353]: plugin: eval failed: bayes: (in learn) locker: safe_lock: cannot create tmp lockfile /.spamassassin/bayes.lock.vestaserver01.example.com.1353 for /.spamassassin/bayes.lock: No such file or directory
Apr  5 00:31:00 vestaserver01 spamd[1353]: spamd: clean message (-1.0/5.0) for nobody:99 in 0.2 seconds, 3138 bytes.
Apr  5 00:31:00 vestaserver01 spamd[1353]: spamd: result: . 0 - ALL_TRUSTED,HTML_MESSAGE scantime=0.2,size=3138,user=nobody,uid=999,required_score=5.0,rhost=localhost,raddr=127.0.0.1,rport=37022,mid=&amp;amp;lt;5520C87B.8020009@example.com&amp;amp;gt;,autolearn=unavailable
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Basically the error are the permissions on: //.spamassassin/user_prefs&lt;/p&gt;

&lt;p&gt;To fix it follow the next steps:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Create the user spamd, in order to avoid to run spamassassin with the user nobody:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;groupadd -g 1001 spamd
useradd -u 1001 -g spamd -s /sbin/nologin -d /var/lib/spamassassin spamd
mkdir /var/lib/spamassassin
chown spamd:spamd /var/lib/spamassassin&amp;lt;/pre&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Edit the file /etc/exim/exim.conf.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;vi /etc/exim/exim.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Change the line:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;spam           = nobody:true/defer_ok
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;spam           = spamd:true/defer_ok
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Restart exim an spamassassin&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;/etc/init.d/exim restart 
/etc/init.d/spamassassin restart
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;After that verify that the files &lt;strong&gt;bayes_seen, bayes_toks and user_prefs&lt;/strong&gt; exists on the spamd home (In this case /var/lib/spamassassin)&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;pwd
/var/lib/spamassassin
ls -la
total 40
drwxr-xr-x  3 spamd spamd  4096 Apr  7 17:58 .
drwxr-xr-x 36 root  root   4096 Feb 25 00:56 ..
-rw-------  1 spamd spamd 12288 Apr  2 21:34 bayes_seen
-rw-------  1 spamd spamd 12288 Apr  2 17:34 bayes_toks
-rw-r--r--  1 spamd spamd  1869 Apr  1 17:18 user_prefs
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Done!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
